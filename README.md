# RPGMaker-MV-Viewer 游戏地图解析器

[![Python](https://img.shields.io/badge/Python-3.x-blue.svg)](https://www.python.org/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Dependencies](https://img.shields.io/badge/dependencies-None-brightgreen.svg)](requirements.txt)

一个基于 Web 的轻量级 RPG Maker MV 游戏辅助工具。无需打开游戏引擎，也不需要运行游戏，即可通过“上帝视角”查看地图细节、解析事件逻辑、搜索隐藏要素，并一键生成 Markdown 格式的游戏地图数据。

本项目为**单文件脚本**，基于 Python 标准库开发，**无需安装任何第三方依赖**。

<img width="2560" height="1237" alt="image" src="https://github.com/user-attachments/assets/15f3f258-82c7-4691-a56d-ed1997ba0700" />

## ✨ 核心功能 (Features)

*   **🗺️ 交互式地图浏览器**
    *   **1:1 还原**：基于 Canvas 渲染地图网格。
    *   **可视化交互**：支持拖拽平移、鼠标滚轮缩放。
    *   **通行度查看**：一键叠加显示地图的通行/阻挡区域。
    *   **图例标记**：自动区分宝箱、传送点、战斗、NPC 对话等事件类型。

*   **🔍 深度事件解析**
    *   **指令翻译**：将 RM 的数字指令（Code 101, 401, 121...）翻译为人类可读的中文文本。
    *   **逻辑透视**：直接显示事件的触发条件（开关/变量/物品）和执行结果。
    *   **智能链接**：点击事件中的“公共事件”、“传送目标”或“敌群”，可直接跳转查看详情。

*   **📝 攻略一键导出**
    *   **Markdown 生成**：支持导出**单张地图**或**全游戏**的文本攻略。
    *   **自动整理**：自动提取宝箱位置、关键剧情触发条件、NPC 坐标等核心信息。

*   **📚 全局数据库与搜索**
    *   **内置图鉴**：直接查看武器、防具、物品、怪物数据的详细数值与属性。
    *   **全局搜索**：支持搜索全地图的对话文本、指令内容、物品名称等。

## 🚀 快速开始 (Getting Started)

### 1. 环境要求
*   Python 3.6 或更高版本。
*   目标游戏的 `www/data` 目录（需包含 `MapInfos.json` 等文件）。

### 2. 安装与运行
本项目为单文件绿色版，无需 `pip install`。

1.  下载本仓库中的 `rpgmv_viewer.py` 文件。
2.  将脚本放置在游戏的 **数据目录** 中（通常是 `www/data/` 文件夹内）。
    *   *注意：脚本必须和 `MapInfos.json` 在同一级目录。*
3.  在终端或命令行运行：
    ```bash
    python rpgmv_viewer.py
    ```
4.  程序会自动启动本地服务器，并调用默认浏览器打开 `http://127.0.0.1:8642`。

### 3. 使用说明

*   **左侧面板**：地图列表树。点击可加载地图。
*   **中间地图**：
    *   `左键拖拽`：移动视角。
    *   `滚轮`：缩放地图。
    *   `左键点击`：查看格子上的事件详情。
*   **右侧面板**：显示解析后的事件逻辑、指令流和详细参数。
*   **顶部菜单**：
    *   `通行度`：切换地形阻挡显示。
    *   `图鉴`：打开数据库查看器。
    *   `全局搜索`：查找游戏内的任何文本或元素。
    *   `导出文本`：生成当前地图的 Markdown 攻略。

## 🔌 API 接口 (For Developers)

虽然是单文件应用，但后端采用了标准的 RESTful 风格，你可以单独调用接口获取 JSON 数据：

| 方法 | 路径 | 描述 |
| :--- | :--- | :--- |
| `GET` | `/api/tree` | 获取地图目录树 |
| `GET` | `/api/map/<id>` | 获取地图数据及解析后的事件对象 |
| `GET` | `/api/search?q=关键词` | 全局搜索 |
| `GET` | `/api/encyclopedia` | 获取整理后的数据库（物品/怪物等） |
| `GET` | `/api/export?map=<id>` | 导出指定地图攻略 |
| `GET` | `/api/export?all=1` | 导出全部地图攻略 |

## 🛠️ 技术细节

*   **后端**：Python `http.server` (无框架，零依赖)。
*   **前端**：原生 HTML5/CSS3/JavaScript (ES6)，单页应用 (SPA) 架构。
*   **解析逻辑**：
    *   通过 `DatabaseManager` 类建立 ID 与名称的映射缓存。
    *   通过 `EventInterpreter` 类实现了 RPG Maker MV 事件指令集的逆向翻译。

## ⚠️ 常见问题

**Q: 启动后报错 "未找到 MapInfos.json"？**
A: 请确保 `rpgmv_viewer.py` 文件是放在游戏的 `data` 文件夹里，它需要读取同级目录下的 JSON 文件。

**Q: 部分图片或头像无法显示？**
A: 本工具专注于**数据与逻辑解析**，为了保持轻量化，未加载游戏的图像资源（img 文件夹），所有视觉元素均由 Canvas 绘制或 CSS 生成。

**Q: 地图是一片黑或者无法加载？**
A: 检查游戏文件是否经过加密（如 `.rpgmvp` 格式）。本工具目前仅支持读取标准的 `.json` 数据文件。

## 📄 许可证

本项目开源，仅供学习交流及个人制作攻略使用。请勿用于破解商业游戏或非法分发受版权保护的游戏资源。
